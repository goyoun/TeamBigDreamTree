<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet"
          integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"
            integrity="sha384-ka7Sk0Gln4gmtz2MlQnikT1wXgYsOg+OMhuP+IlRH9sENBO0LRn5q+8nbTov4+1p"
            crossorigin="anonymous"></script>
    <script src="https://code.jquery.com/jquery-3.6.0.js"></script>
    <script th:inline="javascript">

        /*<![CDATA[*/
        let boardList =/*[[ ${boardList} ]]*/;
        /*]]*/

        let plus = 1


        const getScrollTop = function () {
            return (window.pageYOffset !== undefined) ? window.pageYOffset : (document.documentElement || document.body.parentNode || document.body).scrollTop;
        };

        const getDocumentHeight = function () {
            const body = document.body;
            const html = document.documentElement;
            return Math.max(
                body.scrollHeight, body.offsetHeight, html.clientHeight, html.scrollHeight, html.offsetHeight
            );
        };



        window.onscroll = function(e) {
            if (plus < boardList.totalPages) {
                // console.log("함수호출")
                // console.log(window.innerHeight , window.scrollY,document.body.offsetHeight)
                if(getScrollTop() === getDocumentHeight() - window.innerHeight) {


                    setTimeout(function() {
                        let addScroll = document.getElementById("addScroll")
                        if (!boardList.last) {
                            console.log(!boardList.last)
                            plus += boardList.number + 1
                            const reqUrl = "/scroll/?page=" + plus
                            console.log(reqUrl)
                            $.ajax({
                                type: "get",
                                url: reqUrl,
                                success: function (result) {
                                    console.log("ajax 성공")
                                    console.log(result)
                                    console.log(result.content)

                                    let output = ""

                                    output += "<div class='container d-flex justify-content-center'>"
                                    result.content.forEach(function (board) {
                                        console.log("board : ",board)
                                        console.log("photoList : ",board.photoList)
                                        console.log("boardId : ", board.boardId)
                                        let image = board.photoList
                                        console.log("image : ",image)
                                        output += "<div class='img-wrapper'>"
                                        output += "<a href='/board/"+board.boardId+"'>"
                                        output += "<img src='/upload/"+image[0].boardFilename+"'>"
                                        output += "</a>"
                                        output += "<input type='hidden' id='boardId' value='"+ board.boardId +"'>"
                                        // image.forEach(function (photo) {
                                        //     output += "<div class='img-wrapper'>"
                                        //     console.log("boardFilename",photo.boardFilename)
                                        //     output += "<img src='/upload/"+photo.boardFilename+"'>"
                                        //     output += "</div>"
                                        // })
                                        output += "</div>"
                                    })
                                    output += "</div>"

                                    console.log(output)

                                    addScroll.innerHTML += output


                                },
                                error: function () {
                                    alert("ajax 실패")
                                }
                            })

                        }
                        console.log("확인")
                    }, 0)

                }
            }

        }
    </script>
    <style>
        .container {
            display: flex;
            flex-wrap: wrap;
        }
        body {
            padding: 0;
            margin: 0;
            width: 100%;
        }
        .img-wrapper {
            position: relative;
            width: 400px;
            height: 400px;
        }
        .img-wrapper img {
            position: absolute;
            top: 0;
            left: 0;
            transform: translate(50, 50);
            width: 100%;
            height: 100%;
            object-fit: cover;
            margin: auto;
        }
    </style>
</head>
<body>
<h2>paging</h2>
<a href="/board/save">글 작성</a>
<div class="container d-flex justify-content-center">
    <div class="img-wrapper" th:each="board: ${boardList}">
        <a th:href="@{|/board/${board.boardId}|}">
            <img th:src="@{|/upload/${board.getPhotoList().get(0).getBoardFilename()}|}">
            <input type="hidden" id="boardId" th:value="${board.boardId}">
        </a>
        <!--    <p th:text="${board.boardWriter}"></p>-->
        <!--    <div class="img-wrapper" th:each="photo: ${board.getPhotoList()}">-->
        <!--        <img th:src="@{|/upload/${photo.getBoardFilename()}|}" alt="불러오는중">-->
    </div>
    <!--    <input type="hidden" id="boardContents" th:value="${board.boardContents}">-->
    <!--    <p id="contentElement"></p>-->
</div>

<section id="addScroll">
</section>

</body>
<script>
    // let content = document.getElementById("boardContents").value
    // console.log(content)
    // let splitedArray = content.split(' ');
    // let linkedContent = '';
    // for (let word in splitedArray) {
    //     word = splitedArray[word];
    //     if (word.indexOf('#') == 0) {
    //         word = '<a href=\'링크\'>' + word + '</a>';
    //     }
    //     linkedContent += word + ' ';
    // }
    // document.getElementById('contentElement').innerHTML = linkedContent;
    // // content.innerHTML = linkedContent;
</script>
</html>